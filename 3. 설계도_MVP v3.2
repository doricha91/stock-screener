## 🧭 '설계도 v3.2: 시장 적응형 주도주 선별 시스템' (실행기)
1. 프로젝트 목적: "주도주 선별" (Offensive)
    이 시스템의 유일한 목적은 "오를 것 같은 주식", 즉 현재 시장의 성격과 가장 잘 동기화된 주도주를 선제적으로 발굴하는 것입니다.
    '하락장 방어(위험 관리)'는 이 목적을 달성하기 위한 부수적인 결과입니다.

2. (신규) v4.0 (OOS 백테스터)와의 연동
    이 시스템(v3.2)은 **'연구소(v4.0)'**가 '검증'하고 '확정한' 규칙(MARKET_RULE_MAP)을 '실행'하는 **실행기(Body)**입니다.
    v3.2는 v4.0의 연구 결과(예: { '하락장': 'macd', '강세장': 'dema' })가 config.py에 미리 정의되어 있다고 가정합니다.

3. 핵심 워크플로우: '주도주 깔때기 (The Funnel)'
    [1단계: 시장 정의] -> [2단계: 1차 필터 (기본적)] -> [3단계: 2차 필터 (시장 동조화)] -> [4단계: 최종 선별 (전략 신호)]

4. 워크플로우 상세
    [1단계: 시장 정의] (담당: market_analyzer.py)
    get_market_regime() 함수가 S&P 500 지수, VIX, ADX 등 객관적 지표를 분석하여 현재 시장 상태(예: 'BULL', 'BEAR', 'SIDEWAYS')를 반환합니다.

    [2단계: 1차 필터] (담당: screener.py)
    전체 종목(예: S&P 500)을 대상으로 config.py의 기본 필터(MIN_MARKET_CAP, MIN_VOLUME_AVG 등)를 적용해 대상을 압축합니다.

    [3단계: 2차 필터] (담당: screener.py)
    1단계의 '시장 상태'에 맞는 동조화 필터를 적용합니다.
    (예: 'BULL' 상태라면, 2단계 통과 종목 중 "50일 이평선 위에 있는" 종목만 추가로 필터링)

    [4단계: 최종 선별] (담당: screener.py)
    3단계를 통과한 소수의 '주도주 후보군'을 대상으로, config.py가 지정한 최적의 전략 (예: 'dema')을 실행하여 최종 'Buy' 신호 종목을 선별합니다.

5. 주요 모듈 변경 사항 (To-Do List)
    config.py: MARKET_RULE_MAP (v4.0의 결과물) 추가.
    data_manager.py: get_index_data(VIX) 등 지수 수집, get_sp500_list() 등 종목 리스트 수집 기능.
    market_analyzer.py (신규): get_market_regime() 함수 구현.
    screener.py (대규모 업그레이드):
    '전략 맵(Map)' 방식 (INDICATOR_FUNCTIONS 등) 도입.
    '깔때기 워크플로우' (1차 -> 2차 -> 최종 전략) 로직 구현.
    main.py (대규모 업그레이드):
    v3.2의 전체 워크플로우를 지휘하는 오케스트레이터(Orchestrator) 역할.

6. 확장성 설계 원칙 (v3.1 논의 반영)
    이 설계도는 님의 확장성 질문 3가지를 모두 만족시킵니다.
    [확장성 1: 시장 정의]
    시장 정의 로직은 market_analyzer.py 모듈에 완전히 캡슐화됩니다.
    향후 '장단기 금리차' 같은 새 파라미터를 추가해도, market_analyzer.py 파일만 수정하면 되며 main.py나 screener.py는 수정할 필요가 없습니다.

    [확장성 2: 필터]
    1차/2차 필터 로직은 screener.py 내부에 명확히 분리되어 있습니다.
    config.py에 MIN_PRICE = 10 같은 새 조건을 추가하고 screener.py의 필터 함수에 한 줄 추가하는 것만으로 간단히 필터를 확장할 수 있습니다.

    [확장성 3: 전략]
    screener.py는 run_backtest.py에서 이미 검증된 '전략 맵(Map)' 방식을 그대로 상속받아 사용합니다.
    indicator.py와 strategy.py에 새 함수를 추가하고 screener.py의 '맵'에 등록하는 것만으로, 시스템 전체에서 8번째, 9번째 전략을 즉시 사용할 수 있습니다.